<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zombie Diary 2</title>
    <link rel="stylesheet" href="./css/global-variables.css">
    <link rel="icon" href="./images/zombiediary2.png" type="image/png" />
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <style>
  body { font-family: Arial; margin: 20px; }
  button {
    margin: 5px; padding: 8px 14px; border: none;
    background: #0078d4; color: white; border-radius: 6px;
    cursor: pointer;
  }
  button:hover { background: #005fa3; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background-color: #f5f5f5; }
  a { color: #0078d4; text-decoration: none; }
  a:hover { text-decoration: underline; }

  table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid #696969;
  text-align: left;
  padding: 8px;
}

th {
    background-color: var(--bg-color);
    transition: 
        background-color var(--transition-time),
        color var(--transition-time);
}
</style>
</head>
<body>
    <button class="button-func";; onclick="toggleDarkMode()">Appearance</button>
    <script src="Javascript/darkmode.js"></script>
    <a href="./index.html"> <!--前往按钮的链接-->
    <button class="button-func">
        Go Back <!--文本内容-->
    </button></a>
    <div id="buttonContainer">Loading</div>

<hr>
<div id="tableContainer">Choose a type</div>
<script>
function loadWorkbook(callback) {
  var xhr = new XMLHttpRequest();
  xhr.open('GET', 'zombiediary2.xlsx', true);
  xhr.responseType = 'arraybuffer';

  xhr.onload = function() {
    if (xhr.status === 200) {
      var data = new Uint8Array(xhr.response);
      var workbook = XLSX.read(data, { type: 'array' });
      callback(null, workbook);
    } else {
      callback(new Error('Could not fetch xlsx'));
    }
  };

  xhr.onerror = function() {
    callback(new Error('Internet error, could not fetch xlsx'));
  };

  xhr.send();
}

// 链接转换函数
function convertToLink(text) {
  if (typeof text !== 'string') return text;

  // itms-services 链接
  if (text.match(/^itms-services:\/\/\?action=download-manifest&url=/i)) {
    return '<a href="' + text + '">Download</a>';
  }

  // 普通 http(s) 或 ftp 链接
  if (text.match(/^(https?:\/\/|ftp:\/\/)/i)) {
    return '<a href="' + text + '" target="_blank">Download</a>';
  }

  return text;
}

// 显示工作表按钮
function init() {
  loadWorkbook(function(err, workbook) {
    var container = document.getElementById('buttonContainer');
    if (err) {
      container.innerHTML = '<p style="color:red;"> ' + err.message + '</p>';
      return;
    }

    container.innerHTML = '<b>Choose a type: </b><br>';
    for (var i = 0; i < workbook.SheetNames.length; i++) {
      (function(sheetName) {
        var btn = document.createElement('button');
        btn.textContent = sheetName;
        btn.onclick = function() {
          showSheet(workbook, sheetName);
        };
        container.appendChild(btn);
      })(workbook.SheetNames[i]);
    }
  });
}

// 显示指定工作表内容
function showSheet(workbook, sheetName) {
  var sheet = workbook.Sheets[sheetName];
  if (!sheet) {
    document.getElementById('tableContainer').innerHTML =
      '<p style="color:red;">Could not find:' + sheetName + '</p>';
    return;
  }

  var rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
  var html = '<h3>' + sheetName + '</h3><table>';
  for (var r = 0; r < rows.length; r++) {
    html += '<tr>';
    for (var c = 0; c < rows[r].length; c++) {
      var cellText = convertToLink(rows[r][c]);
      html += (r === 0 ? '<th>' : '<td>') + cellText + (r === 0 ? '</th>' : '</td>');
    }
    html += '</tr>';
  }
  html += '</table>';
  document.getElementById('tableContainer').innerHTML = html;
}

// 初始化
if (window.addEventListener) {
  window.addEventListener('load', init, false);
} else if (window.attachEvent) {
  window.attachEvent('onload', init);
} else {
  window.onload = init;
}
</script>
</body>
</html>